From 9adb6eba2bbf0987e07c817e50b5996628e63c2e Mon Sep 17 00:00:00 2001
From: Yash Goyal <ygoyal@wigwag.com>
Date: Wed, 3 Mar 2021 16:25:44 -0800
Subject: [PATCH] fix pal-platform Yocto target dependencies

---
 lib/CMakeLists.txt                 | 12 ++++++------
 lib/pal-platform/pal-platform.json | 19 ++++++++++++++-----
 lib/pal-platform/requirements.txt  |  2 ++
 3 files changed, 22 insertions(+), 11 deletions(-)

diff --git a/lib/CMakeLists.txt b/lib/CMakeLists.txt
index 2c93abe..e38fb25 100644
--- a/lib/CMakeLists.txt
+++ b/lib/CMakeLists.txt
@@ -31,21 +31,21 @@ if (PARSEC_TPM_SE_SUPPORT OR (FOTA_ENABLE AND NOT MBED_CLOUD_CLIENT_CURL_DYNAMIC
   include (${CMAKE_PLATFORM})
 
   message("TARGET ${PLATFORM_TARGET}")
-  find_program(PIP pip)
+  find_program(PIP pip3)
   if (NOT PIP)
-    message(FATAL_ERROR "pip not found!")
+    message(FATAL_ERROR "pip3 not found!")
   endif ()
 
-  execute_process( COMMAND pip install -r pal-platform/requirements.txt
+  execute_process( COMMAND pip3 install -r pal-platform/requirements.txt
                     RESULT_VARIABLE CMD_ERROR
                     WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR})
 
-  find_program(PYTHON python)
+  find_program(PYTHON python3)
   if (NOT PYTHON)
-    message(FATAL_ERROR "python not found!")
+    message(FATAL_ERROR "python3 not found!")
   endif ()
 
-  execute_process( COMMAND python pal-platform/pal-platform.py
+  execute_process( COMMAND python3 pal-platform/pal-platform.py
                   deploy --target=${PLATFORM_TARGET}
                   RESULT_VARIABLE CMD_ERROR
                   WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR} )
diff --git a/lib/pal-platform/pal-platform.json b/lib/pal-platform/pal-platform.json
index caf0e0e..a704e96 100644
--- a/lib/pal-platform/pal-platform.json
+++ b/lib/pal-platform/pal-platform.json
@@ -89,14 +89,23 @@
         },
         "to": "Middleware/mbedtls/mbedtls"
       },
-      "curl": {
-        "version": "7.72.0",
+      "trusted_storage": {
+        "version": "1.0.0",
         "from": {
           "protocol": "git",
-          "location": "https://github.com/curl/curl.git",
-          "tag": "curl-7_72_0"
+          "location": "https://github.com/ARMmbed/psa_trusted_storage_linux.git",
+          "tag": "ptsl-0.0.1-psa-storage-api-1.0.0"
         },
-        "to": "Middleware/curl/curl"
+        "to": "Middleware/trusted_storage/trusted_storage"
+      },
+      "parsec_se_driver": {
+        "version": "0.3.1",
+        "from": {
+          "protocol": "git",
+          "location": "https://github.com/parallaxsecond/parsec-se-driver.git",
+          "tag": "0.3.1"
+        },
+        "to": "Middleware/parsec_se_driver/parsec_se_driver"
       }
     }
   },
diff --git a/lib/pal-platform/requirements.txt b/lib/pal-platform/requirements.txt
index d6a7e11..7fc6dc1 100644
--- a/lib/pal-platform/requirements.txt
+++ b/lib/pal-platform/requirements.txt
@@ -1,2 +1,4 @@
 click>=6.5,<7.2
 requests>=2.1,<2.21
+intelhex>=2,<3
+imgtool>=1,<2
-- 
2.17.1

